<h2>Ny produkt</h2>

<form id="new-product-form" action="/admin/products/new" method="POST">
  
  <div class="form-group">
    <label for="name">Namn</label>
    <input type="text" id="name" name="name" required>
  </div>

  <div class="form-group">
    <label for="description">Beskrivning</label>
    <textarea id="description" name="description" rows="4" required></textarea>
  </div>

  <div class="form-group">
    <label for="image">Bild (URL)</label>
    <input type="text" id="image" name="image" required>
  </div>

  <div class="form-group">
    <label for="price">Pris</label>
    <input type="number" step="0.01" id="price" name="price" required>
  </div>

  <div class="form-group">
    <label for="sku">SKU</label>
    <input type="text" id="sku" name="sku" required>
  </div>

  <div class="form-group">
    <label for="published">
      <input type="checkbox" id="published" name="published">
      Publicera
    </label>
  </div>

  <button type="submit">Lägg till</button>
</form>

<script>
const form = document.getElementById('new-product-form');

form.addEventListener('submit', async (e) => {
  e.preventDefault(); // Hindra att sidan laddas om

  // Hämta värden från formuläret
  const productData = {
    name: document.getElementById('name').value.trim(),
    description: document.getElementById('description').value.trim(),
    image: document.getElementById('image').value.trim(),
    price: parseFloat(document.getElementById('price').value),
    sku: document.getElementById('sku').value.trim(),
    published: document.getElementById('published').checked
  };

  try {
 const response = await fetch('/admin/api/products', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(productData)
});

    if (response.status === 201) {
      const result = await response.json();
      // Redirect till detaljsida
      window.location.href = `/admin/products/${result.id}`;
    } else {
      const error = await response.json();
      alert('Fel: ' + (error.error || 'Okänt fel'));
    }

  } catch (err) {
    console.error(err);
    alert('Ett fel uppstod vid skapandet av produkten.');
  }
});
</script>

